<UserControl x:Class="WebBrowserMinimalist.Views.Controls.TabItem"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:WebBrowserMinimalist.Views.Controls"
             xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
             xmlns:context="clr-namespace:WebBrowserMinimalist.ViewModels"
             xmlns:helpers="clr-namespace:WebBrowserMinimalist.Helpers"
             xmlns:web="clr-namespace:Microsoft.Web.WebView2.Wpf;assembly=Microsoft.Web.WebView2.Wpf"
             mc:Ignorable="d" 
             d:DesignHeight="450" d:DesignWidth="484" Background="{x:Null}">
    <UserControl.DataContext>
        <context:TabItemVM ></context:TabItemVM>
    </UserControl.DataContext>
    <UserControl.Resources>
        <BooleanToVisibilityConverter x:Key="convertToVisibility"></BooleanToVisibilityConverter>
    </UserControl.Resources>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="38"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        <Rectangle Fill="{ui:ThemeResource}" Opacity="0.2"></Rectangle>
        <Grid ClipToBounds="True">

            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="auto"></ColumnDefinition>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="150"/>
            </Grid.ColumnDefinitions>
            <StackPanel Orientation="Horizontal" Margin="4">
                <ui:Button  WindowChrome.IsHitTestVisibleInChrome="True" Appearance="Transparent" Command="{Binding BackCommand}" CommandParameter="{Binding ElementName=webview}" Visibility="{Binding CanGoBack,ElementName=webview,Converter={StaticResource convertToVisibility}}" BorderThickness="0" BorderBrush="Transparent" VerticalAlignment="Stretch" >
                    <ui:SymbolIcon Symbol="ArrowLeft12"></ui:SymbolIcon>
                </ui:Button>
                <Grid Width="36">
                    <ui:Button Name="btnRefresh" WindowChrome.IsHitTestVisibleInChrome="True" Appearance="Transparent" Visibility="{Binding Refreshvisibility}" Command="{Binding RefreshCommand}" CommandParameter="{Binding ElementName=webview}" BorderThickness="0" BorderBrush="Transparent" VerticalAlignment="Stretch">
                        <ui:SymbolIcon Symbol="ArrowReset24"></ui:SymbolIcon>
                    </ui:Button>
                    <ui:ProgressRing Name="progressring" IsIndeterminate="True" Visibility="{Binding ProgressVisibility}" Height="16" Width="16"></ui:ProgressRing>
                </Grid>
                <ui:Button  WindowChrome.IsHitTestVisibleInChrome="True" Appearance="Transparent" BorderThickness="0" Command="{Binding LeftCommand}" CommandParameter="{Binding ElementName=webview}" Visibility="{Binding  CanGoForward,ElementName=webview,Converter={StaticResource convertToVisibility}}" BorderBrush="Transparent" VerticalAlignment="Stretch" >
                    <ui:SymbolIcon Symbol="ArrowRight12"></ui:SymbolIcon>
                </ui:Button>
            </StackPanel>
            <Rectangle Fill="{Binding Foreground,ElementName=symbol}" Width="1" HorizontalAlignment="Right" RadiusX="1" RadiusY="1" Margin="0,15,0,15"></Rectangle>
            <Grid Grid.Column="1" HorizontalAlignment="Stretch" VerticalAlignment="Center"  Margin="4,0,0,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="auto"></ColumnDefinition>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <Grid Name="URLSearchBar" MaxWidth="370" Margin="10,0,10,0" Visibility="Collapsed" Grid.Column="1" >

                    <ui:Badge ClipToBounds="True" BorderThickness="0" HorizontalAlignment="Center" Background="Transparent" MaxWidth="370" Padding="0" Width="{Binding ActualWidth,ElementName=URLSearchBar}" Height="28" HorizontalContentAlignment="Center" >

                        <Grid>
                            <Rectangle Grid.ColumnSpan="10" Fill="{Binding Foreground,ElementName=symbol}" Opacity="0.1" RadiusX="3.563" RadiusY="3.563"></Rectangle>
                            <ui:TextBox ClipToBounds="True" Icon="Empty" Name="TxtSearch"  Text="{Binding UrlSource}" MouseDoubleClick="TxtSearch_MouseDoubleClick" KeyDown="txtSearch_KeyDown" VerticalAlignment="Stretch" ClearButtonEnabled="False" WindowChrome.IsHitTestVisibleInChrome="True"  BorderThickness="0" Background="Transparent"  PlaceholderText="url or Search" TextAlignment="Center"  Padding="30,2,30,0" BorderBrush="{x:Null}"/>
                            <ui:Button Name="ReturnToIndicator" ToolTip="Cerrar Barra de Busqueda" Click="ReturnToIndicator_Click" Padding="5,2,5,5" WindowChrome.IsHitTestVisibleInChrome="True" Appearance="Transparent" BorderThickness="0" BorderBrush="Transparent" VerticalAlignment="Stretch" >
                                <ui:SymbolIcon Symbol="ArrowRight12" Filled="True" FontSize="16"></ui:SymbolIcon>
                            </ui:Button>
                            <ui:Button Name="btnSettingEngines" ToolTip="Configuracion de Motor de Busqueda" HorizontalAlignment="Right" Click="btnSettingEngines_Click" WindowChrome.IsHitTestVisibleInChrome="True" Padding="5,2,5,5" Appearance="Transparent" BorderThickness="0" BorderBrush="Transparent" VerticalAlignment="Stretch" >
                                <ui:SymbolIcon Symbol="Settings20" FontSize="16"></ui:SymbolIcon>
                            </ui:Button>


                        </Grid>
                    </ui:Badge>

                </Grid>
                <ui:Badge x:Name="IndicatorDocumentPage" Margin="10,0,10,0"  Background="Transparent" Grid.Column="1" MaxWidth="370" Padding="0" Height="28" >
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="auto"/>
                        </Grid.ColumnDefinitions>
                        <Rectangle Grid.ColumnSpan="10" Fill="{Binding Foreground,ElementName=symbol}" Opacity="0.1" RadiusX="3.563" RadiusY="3.563"></Rectangle>
                        <StackPanel Orientation="Horizontal" Margin="4,0,0,0">
                            <ui:SymbolIcon Name="symbol" Symbol="{Binding ShieldIcon}" Margin="4,0,6,0" FontSize="18"></ui:SymbolIcon>
                            <ui:SymbolIcon Visibility="{Binding SoundVisibility,Mode=OneWay}" Symbol="Speaker224" Margin="2,0,6,0" FontSize="16"></ui:SymbolIcon>
                        </StackPanel>
                        <ui:Button  Name="btnChangeToSearch" Click="btnChangeToSearch_Click" Padding="7,2,7,5" Grid.Column="3" Margin="0,0,0,0" WindowChrome.IsHitTestVisibleInChrome="True" Appearance="Transparent" BorderThickness="0" BorderBrush="Transparent" VerticalAlignment="Stretch" >
                            <ui:SymbolIcon Symbol="Search12" Filled="True" FontSize="12"></ui:SymbolIcon>
                        </ui:Button>
                        <Grid HorizontalAlignment="Center" Grid.Column="1">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="auto"></ColumnDefinition>
                                <ColumnDefinition Width="auto"></ColumnDefinition>
                                <ColumnDefinition Width="*"></ColumnDefinition>
                                <ColumnDefinition Width="auto"></ColumnDefinition>
                            </Grid.ColumnDefinitions>

                            <Image Name="img" Source="{Binding Image}" Grid.Column="1" Height="16" Width="16" Stretch="Uniform"></Image>
                            <TextBlock VerticalAlignment="Center" WindowChrome.IsHitTestVisibleInChrome="True" ToolTip="{Binding TitleDocument}" FontSize="13" Grid.Column="2" Foreground="{Binding Foreground, ElementName=symbol}" HorizontalAlignment="Stretch" Opacity="1" FontStretch="ExtraExpanded" Text="{Binding TitleDocument}" Margin="7,0,0,0" Padding="0" TextTrimming="CharacterEllipsis" FontFamily="Segoe UI Semibold" />


                        </Grid>
                    </Grid>
                </ui:Badge>

                <StackPanel Orientation="Horizontal">
                    <ui:Button Name="menubtn" Click="menubtn_Click" Height="{Binding ActualHeight,ElementName=btnRefresh}" Grid.Column="0" Margin="0,0,0,0" WindowChrome.IsHitTestVisibleInChrome="True" Appearance="Transparent" BorderThickness="0" BorderBrush="Transparent" VerticalAlignment="Stretch" >
                        <ui:SymbolIcon Symbol="Tabs24" Filled="False"></ui:SymbolIcon>
                    </ui:Button>
                    <Button  Name="countitem" Margin="4,0,0,0" Height="22" Padding="7,0" FontSize="12" VerticalAlignment="Stretch" Content="{Binding Items.Count, Mode=OneWay}" >
                    </Button>
                </StackPanel>
            </Grid>
        </Grid>
        <web:WebView2 Name="webview" Grid.Row="1" Source="{Binding Url, Mode=OneWay}" DefaultBackgroundColor="Black">

        </web:WebView2>


    </Grid>
</UserControl>
